import streamlit as st
import textwrap

# --- 1. è¨­å®šç¶²é æ¨™é¡Œèˆ‡ç‰ˆé¢ ---
st.set_page_config(page_title="ç”³è«‹ç ”ç©¶æ‰€è‡ªå‚³ç”Ÿæˆç³»çµ±", page_icon="ğŸ“", layout="centered")

st.title("ğŸ“ ç”³è«‹ç ”ç©¶æ‰€è‡ªå‚³ç”Ÿæˆç³»çµ±")
st.markdown("""
æ­¡è¿ä½¿ç”¨ï¼æ­¤ç³»çµ±èƒ½å”åŠ©æ‚¨å¿«é€Ÿç”Ÿæˆç”³è«‹ç ”ç©¶æ‰€çš„è‡ªå‚³åˆç¨¿ã€‚
è«‹ä¾åºå¡«å¯«ä»¥ä¸‹æ¬„ä½ï¼Œç³»çµ±å°‡æ ¹æ“šæ‚¨æä¾›çš„è³‡è¨Šï¼Œè‡ªå‹•ç”Ÿæˆçµæ§‹å®Œæ•´ã€èªæ°£å°ˆæ¥­çš„è‡ªå‚³ã€‚
""")

# --- 2. å®šç¾©å´é‚Šæ¬„èªªæ˜ ---
with st.sidebar:
    st.header("ğŸ’¡ ä½¿ç”¨èªªæ˜")
    st.markdown("""
    1. ä¾åºå¡«å¯«å³å´è¡¨å–®ã€‚
    2. è¶Šå…·é«”çš„æè¿°ï¼Œç”Ÿæˆçš„è‡ªå‚³è¶Šç¨ç‰¹ã€‚
    3. é»æ“Šæœ€ä¸‹æ–¹çš„ã€Œ**ä¸€éµç”Ÿæˆè‡ªå‚³**ã€ã€‚
    4. æ‚¨å¯ä»¥è¤‡è£½å…§å®¹æˆ–ç›´æ¥ä¸‹è¼‰ .txt æª”æ¡ˆã€‚
    """)
    st.info("æ­¤ç³»çµ±ä¾ç…§æ¨™æº–å­¸è¡“è‡ªå‚³æ¶æ§‹è¨­è¨ˆï¼šå‰è¨€ã€èƒŒæ™¯ã€å­¸æ­·ã€ç¶“æ­·ã€å±•æœ›ã€çµè«–ã€‚")

# --- 3. å»ºç«‹è¼¸å…¥è¡¨å–® (ä¾ç…§å…ˆå‰è¨­è¨ˆçš„äº”å¤§å€å¡Š) ---

with st.form("autobiography_form"):
    
    # å€å¡Š A: åŸºæœ¬è³‡æ–™
    st.subheader("ğŸ“Œ 1. å€‹äººåŸºæœ¬è³‡æ–™")
    col1, col2 = st.columns(2)
    with col1:
        name = st.text_input("å§“å", placeholder="ä¾‹å¦‚ï¼šé™³ç‘‹æ‰¿")
        phone = st.text_input("è¯çµ¡é›»è©±", placeholder="09XX-XXXXXX")
    with col2:
        email = st.text_input("é›»å­éƒµä»¶", placeholder="example@email.com")
        highest_degree = st.text_input("æœ€é«˜å­¸æ­· (å­¸æ ¡/ç³»æ‰€/å­¸ä½)", placeholder="ä¾‹å¦‚ï¼šåœ‹ç«‹è‡ºåŒ—å¤§å­¸ä¸­æ–‡ç³»ç¢©å£«")
    
    undergrad_degree = st.text_input("å­¸å£«å­¸æ­· (å­¸æ ¡/ç³»æ‰€)", placeholder="ä¾‹å¦‚ï¼šæ·¡æ±Ÿå¤§å­¸ä¸­æ–‡ç³»")
    research_interests = st.text_input("æ‚¨çš„æ ¸å¿ƒç ”ç©¶é ˜åŸŸ/é—œéµå­—", placeholder="ä¾‹å¦‚ï¼šæ–‡å­—å­¸ã€æ•¸ä½äººæ–‡ã€æ¼¢å­—æ•™å­¸")

    # å€å¡Š B: ç›®æ¨™ç³»æ‰€ (å®¢è£½åŒ–)
    st.subheader("ğŸ¯ 2. ç›®æ¨™ç”³è«‹ç³»æ‰€")
    target_school = st.text_input("ç›®æ¨™å­¸æ ¡å…¨ç¨±", placeholder="ä¾‹å¦‚ï¼šåœ‹ç«‹è‡ºç£å¤§å­¸")
    col3, col4 = st.columns(2)
    with col3:
        target_dept = st.text_input("ç›®æ¨™ç³»æ‰€å…¨ç¨±", placeholder="ä¾‹å¦‚ï¼šä¸­åœ‹æ–‡å­¸ç³»åšå£«ç­")
    with col4:
        target_group = st.text_input("æ¬²ç”³è«‹çµ„åˆ¥ (é¸å¡«)", placeholder="ä¾‹å¦‚ï¼šå¤æ–‡å­—å­¸çµ„")
    
    dept_feature = st.text_area("è©²ç³»æ‰€å¸å¼•æ‚¨çš„æ ¸å¿ƒç‰¹è‰²", placeholder="ä¾‹å¦‚ï¼šè²´æ‰€åœ¨ã€Œå‡ºåœŸæ–‡ç»ã€é ˜åŸŸå…·å‚™é ‚å°–è³‡æºï¼Œä¸”å¸«è³‡é™£å®¹å …å¼·...")
    target_professor = st.text_input("æƒ³è·Ÿéš¨çš„æŒ‡å°æ•™æˆ (é¸å¡«)", placeholder="ä¾‹å¦‚ï¼šæ›¾æ˜±å¤« æ•™æˆ")

    # å€å¡Š C: ç¶“æ­·èˆ‡æˆå°±
    st.subheader("ğŸ† 3. ç¶“æ­·èˆ‡æˆå°±")
    academic_performance = st.text_input("å­¸æ¥­é‡åŒ–è¡¨ç¾", placeholder="ä¾‹å¦‚ï¼šç­æ’å‰äº”ï¼Œæ›¾ç²å…©æ¬¡æ›¸å·ç")
    resilience_story = st.text_area("å±•ç¾éŸŒæ€§/è¡Œå‹•åŠ›çš„ç°¡çŸ­å¯¦ä¾‹", placeholder="ä¾‹å¦‚ï¼šåŠå·¥åŠè®€å®Œæˆå­¸æ¥­ï¼Œä¸¦æ›¾å‰µæ¥­ç¶“ç‡Ÿæ—©é¤åº—ï¼ŒåŸ¹é¤Šäº†è§£æ±ºå•é¡Œçš„èƒ½åŠ›ã€‚")
    
    st.markdown("**æ ¸å¿ƒæˆå°± (è«‹åˆ—å‡º 1-3 é …å…·é«”æˆæœ)**")
    achievement_1 = st.text_input("æˆå°± 1", placeholder="ä¾‹å¦‚ï¼šç™¼è¡¨å…©ç¯‡æ•¸ä½äººæ–‡ç›¸é—œè«–æ–‡")
    achievement_2 = st.text_input("æˆå°± 2", placeholder="ä¾‹å¦‚ï¼šæ“”ä»»å­¸å ±ç·¨è¼¯åŠ©ç†ä¸‰å¹´ï¼Œç†Ÿæ‚‰å­¸è¡“è¡Œæ”¿")
    achievement_3 = st.text_input("æˆå°± 3 (é¸å¡«)", placeholder="ä¾‹å¦‚ï¼šå…©åº¦æ“”ä»»åœ‹éš›ç ”è¨æœƒç¸½å¬")

    # å€å¡Š D: ç ”ç©¶å±•æœ›
    st.subheader("ğŸ”­ 4. ç ”ç©¶æ–¹å‘èˆ‡å±•æœ›")
    thesis_topic = st.text_input("éå»æ ¸å¿ƒå°ˆé¡Œ/è«–æ–‡ä¸»é¡Œ", placeholder="ä¾‹å¦‚ï¼šéƒ¨ä»¶èˆ‡åœ–åƒçµåˆä¹‹æ¼¢å­—æ•™å­¸ç ”ç©¶")
    short_term_goal = st.text_area("çŸ­æœŸç›®æ¨™ (å…¥å­¸å¾Œ)", placeholder="ä¾‹å¦‚ï¼šæ·±å…¥æ¢è¨æ¼¢å­—æ§‹å½¢é¡åŒ–ï¼Œä¸¦ç ”ç©¶é™ä½éŒ¯å­—ç‡çš„æ–¹æ³•ã€‚")
    long_term_goal = st.text_input("é•·æœŸç›®æ¨™ (ç•¢æ¥­å¾Œ)", placeholder="ä¾‹å¦‚ï¼šå°‡ç ”ç©¶æ‡‰ç”¨æ–¼å°å¤–è¯èªæ•™å­¸ï¼Œæˆç‚ºè·¨åŸŸå­¸è€…ã€‚")

    # é€å‡ºæŒ‰éˆ•
    submitted = st.form_submit_button("âœ¨ ä¸€éµç”Ÿæˆè‡ªå‚³")

# --- 4. ç”Ÿæˆé‚è¼¯ ---

if submitted:
    # æª¢æŸ¥å¿…å¡«
    if not name or not target_school or not target_dept:
        st.error("è«‹è‡³å°‘å¡«å¯«ã€Œå§“åã€ã€ã€Œç›®æ¨™å­¸æ ¡ã€èˆ‡ã€Œç›®æ¨™ç³»æ‰€ã€æ‰èƒ½ç”Ÿæˆå–”ï¼")
    else:
        # è™•ç†é¸å¡«æ¬„ä½
        achievements = [a for a in [achievement_1, achievement_2, achievement_3] if a]
        achievements_text = "\n".join([f"* {item}" for item in achievements])
        
        prof_text = f"æˆ‘å°¤å…¶æ¬£è³**{target_professor}**åœ¨è©²é ˜åŸŸçš„å“è¶Šç ”ç©¶ã€‚" if target_professor else ""
        group_text = f"ã€{target_group}ã€‘" if target_group else ""

        # ç”Ÿæˆæ–‡æœ¬æ¨¡æ¿
        generated_text = f"""
{target_school} {target_dept} ç”³è«‹è‡ªå‚³
==================================================

### ä¸€ã€ å‰è¨€èˆ‡ç”³è«‹å‹•æ©Ÿ
æˆ‘æ˜¯{name}ï¼Œç•¢æ¥­æ–¼{highest_degree}ã€‚æˆ‘å°**{research_interests}**çš„ç ”ç©¶æ‡·æŠ±é«˜åº¦ç†±å¿±ï¼Œæ·±ä¿¡**{target_school} {target_dept}** åœ¨ã€Œ**{dept_feature}**ã€æ–¹é¢å…·å‚™é ‚å°–è³‡æºï¼Œæ˜¯èƒ½è®“æˆ‘æ·±åŒ–**{group_text}**ç ”ç©¶çš„æœ€ä½³å­¸è¡“æ®¿å ‚ã€‚æˆ‘å…·å‚™ç´®å¯¦çš„**{research_interests}**åŸºç¤ï¼Œå¸Œæœ›èƒ½æœ‰æ©ŸæœƒåŠ å…¥è²´æ‰€ï¼Œè²¢ç»æ‰€å­¸ã€‚

### äºŒã€ æˆé•·èƒŒæ™¯èˆ‡å€‹äººç‰¹è³ª
æˆ‘çš„è™•äº‹è§€å¿µæ˜¯ã€Œä¸åšä¸æœƒæ€æ¨£ï¼Œåšäº†å¾ˆä¸ä¸€æ¨£ã€ï¼Œä¸¦ä»¥ã€Œäº‹æƒ…è¦åšåˆ°æœ€å¥½ã€è¦æ±‚è‡ªå·±ã€‚åœ¨æˆé•·éç¨‹ä¸­ï¼Œæˆ‘å› **{resilience_story}**ï¼ŒåŸ¹é¤Šå‡ºå¼·å¤§çš„**è¡Œå‹•åŠ›èˆ‡æ±ºå¿ƒ**ã€‚é€™æ®µç¶“æ­·ä½¿æˆ‘å…·å‚™ç¨ç«‹æ€è€ƒã€è§£æ±ºå•é¡Œçš„èƒ½åŠ›ï¼Œä¸¦ä»¥æ¨‚è§€ç©æ¥µçš„æ…‹åº¦é¢å°å­¸è¡“æŒ‘æˆ°ã€‚

### ä¸‰ã€ æ±‚å­¸æ­·ç¨‹èˆ‡å­¸è¡“è¡¨ç¾
æˆ‘å¤§å­¸ç•¢æ¥­æ–¼{undergrad_degree}ï¼Œåœ¨å­¸æœŸé–“ï¼Œæˆ‘å­¸æ¥­è¡¨ç¾å„ªç•°ï¼Œé”åˆ°**{academic_performance}**ã€‚ç¢©å£«éšæ®µï¼Œæˆ‘æ–¼{highest_degree}ä¸»å‹•æ¥è§¸ç›¸é—œé ˜åŸŸï¼Œä¸¦æˆåŠŸå°‡ç†è«–æ‡‰ç”¨æ–¼å¯¦å‹™ï¼Œå±•ç¾å­¸è¡“æ½›åŠ›ã€‚

### å››ã€ ç¶“æ­·èˆ‡æˆæœ
æˆ‘æ“æœ‰è±å¯Œçš„å¯¦å‹™ç¶“é©—ï¼Œå±•ç¾å‡ºå„ªç•°çš„çµ„ç¹”èˆ‡åŸ·è¡Œèƒ½åŠ›ã€‚æ ¸å¿ƒç¶“æ­·èˆ‡æˆæœå¦‚ä¸‹ï¼š
{achievements_text}

### äº”ã€ ç ”ç©¶æ–¹å‘èˆ‡æœªä¾†å±•æœ›
æˆ‘çš„éå»ç ”ç©¶æ ¸å¿ƒä¸»é¡Œæ˜¯**{thesis_topic}**ã€‚{prof_text}æˆ‘æ¸´æœ›èƒ½åœ¨è²´æ‰€æŒ‡å°ä¸‹ï¼Œå®Œæˆ**{short_term_goal}**ï¼Œæœªä¾†å°‡æœ**{long_term_goal}**æ–¹å‘å‰é€²ï¼Œæˆç‚º**{research_interests}**é ˜åŸŸçš„å°ˆæ¥­äººæ‰ã€‚

### å…­ã€ çµè«–
æˆ‘æ·±ä¿¡ï¼Œæˆ‘åœ¨**{research_interests}**ä¸Šçš„ç ”ç©¶ç†±å¿±ä»¥åŠå¯¦å‹™ç¶“é©—ï¼Œä½¿æˆ‘æˆç‚ºè²´æ‰€çš„ç†æƒ³äººé¸ã€‚æ‡‡è«‹è²´æ‰€æ•™æˆçµ¦äºˆé¢è©¦æ©Ÿæœƒï¼Œè®“æˆ‘èƒ½è¦ªè‡ªèªªæ˜æˆ‘çš„å­¸ç¿’æˆæœèˆ‡æœªä¾†è¦åŠƒã€‚æ„Ÿè¬æ‚¨çš„å¯©é–±ã€‚
--------------------------------------------------
ç”³è«‹äººï¼š{name}
è¯çµ¡é›»è©±ï¼š{phone}
Emailï¼š{email}
"""

        # --- 5. é¡¯ç¤ºçµæœ ---
        st.success("âœ… è‡ªå‚³ç”ŸæˆæˆåŠŸï¼")
        st.markdown("### ğŸ“„ ç”Ÿæˆçµæœé è¦½")
        st.markdown(generated_text)
        
        # --- 6. ä¸‹è¼‰æŒ‰éˆ• ---
        st.download_button(
            label="ğŸ“¥ ä¸‹è¼‰è‡ªå‚³ (.txt)",
            data=generated_text,
            file_name=f"{name}_{target_school}_è‡ªå‚³.txt",
            mime="text/plain"
        )